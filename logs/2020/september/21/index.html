<!doctype html><html lang=en class=h-100><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.62.2"><link rel=stylesheet href=https://puneethapai.github.io/css/bootstrap.min.css><title>Python: regex, concurrency | Puneeth</title><style>.container{max-width:800px}#nav a{font-weight:700;color:inherit}#nav a.nav-link-active{background-color:#212529;color:#fff}#nav-border{border-bottom:1px solid #212529}#main{margin-top:1em;margin-bottom:4em}#home-jumbotron{background-color:inherit}#footer .container{padding:1em 0}#footer a{color:inherit;text-decoration:underline}.font-125{font-size:125%}.tag-btn{margin-bottom:.3em}pre{background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;padding:16px}pre code{padding:0;font-size:inherit;color:inherit;background-color:transparent;border-radius:0}code{padding:2px 4px;font-size:90%;color:#c7254e;background-color:#f9f2f4;border-radius:4px}img,iframe,embed,video,audio{max-width:100%}.card-img,.card-img-top,.card-img-bottom{width:initial}</style></head><body class="d-flex flex-column h-100"><div id=nav-border class=container><nav id=nav class="nav justify-content-center"><a class=nav-link href=/><i data-feather=home></i>Home</a>
<a class=nav-link href=/blogs/><i data-feather=edit></i>Blog</a>
<a class=nav-link href=/logs/><i data-feather=edit></i>Log</a>
<a class=nav-link href=/categories/><i data-feather=tag></i>Categories</a>
<a class=nav-link href=/about/><i data-feather=smile></i>About</a>
<a class=nav-link href=/index.xml><i data-feather=rss></i>RSS</a></nav></div><div class=container><main id=main><h1>Python: regex, concurrency</h1><h4 id=regex>Regex:</h4><p>Python built in <code>re</code> module is really handy.</p><ul><li><code>re.match</code> always matches whole string</li><li><code>re.search</code> you almost always want to use this, as here you will search the matching substirng for given pattern.</li></ul><p>Here are some usefull patterns and function which will come in handy:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e># Usefull patterns:</span>
URL_PATTERN <span style=color:#f92672>=</span> <span style=color:#e6db74>r</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>(http|ftp|https)://([</span><span style=color:#e6db74>\</span><span style=color:#e6db74>w_-]+(?:(?:</span><span style=color:#e6db74>\</span><span style=color:#e6db74>.[</span><span style=color:#e6db74>\</span><span style=color:#e6db74>w_-]+)+))([</span><span style=color:#e6db74>\</span><span style=color:#e6db74>w.,@?^=</span><span style=color:#e6db74>%</span><span style=color:#e6db74>&amp;:/~+#-]*[</span><span style=color:#e6db74>\</span><span style=color:#e6db74>w@?^=</span><span style=color:#e6db74>%</span><span style=color:#e6db74>&amp;/~+#-])?</span><span style=color:#e6db74>&#34;</span>
MAN_PAGE_PATTERN <span style=color:#f92672>=</span> <span style=color:#e6db74>r</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>man</span><span style=color:#e6db74>\</span><span style=color:#e6db74>d/.+.html$</span><span style=color:#e6db74>&#34;</span>
GIT_REPO_NAME_PATTERN <span style=color:#f92672>=</span> <span style=color:#e6db74>r</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>[^/]+.git$</span><span style=color:#e6db74>&#34;</span>

<span style=color:#75715e># Useful wrapper around `re.search`</span>
<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_match</span>(pattern: str, string: str) <span style=color:#f92672>-</span><span style=color:#f92672>&gt;</span> str <span style=color:#f92672>or</span> None:
    <span style=color:#e6db74></span><span style=color:#e6db74>&#34;&#34;&#34;</span><span style=color:#e6db74>Scan through string looking for a match to the pattern, returning</span><span style=color:#e6db74>
</span><span style=color:#e6db74></span><span style=color:#e6db74>    a Match sub string, or None if no match was found.</span><span style=color:#e6db74>&#34;&#34;&#34;</span>

    match <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>search(URL_PATTERN, tldr_summary)
    <span style=color:#66d9ef>return</span> match<span style=color:#f92672>.</span>group() <span style=color:#66d9ef>if</span> match <span style=color:#66d9ef>else</span> None
</code></pre></div><h4 id=concurrency>Concurrency:</h4><p>In python with in built modules <code>multiprocessing</code> and <code>concurrent</code> converting your single process single threaded program has been pretty easy.</p><p>For example:
Simple Example to convert any list comprehension to execute <strong>&ldquo;concurrently&rdquo;</strong></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e># test_concurrency.py</span>
<span style=color:#f92672>import</span> time
<span style=color:#f92672>import</span> timeit
<span style=color:#f92672>from</span> concurrent.futures <span style=color:#f92672>import</span> ProcessPoolExecutor, ThreadPoolExecutor

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>parallelize</span>(func, iterable, use_thread<span style=color:#f92672>=</span>True, max_workers<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span>):
    pool_executor <span style=color:#f92672>=</span> ThreadPoolExecutor <span style=color:#66d9ef>if</span> use_thread <span style=color:#66d9ef>else</span> ProcessPoolExecutor
    <span style=color:#66d9ef>with</span> pool_executor(max_workers<span style=color:#f92672>=</span>max_workers) <span style=color:#66d9ef>as</span> executor:
        data <span style=color:#f92672>=</span> list(executor<span style=color:#f92672>.</span>map(func, iterable))
    <span style=color:#66d9ef>return</span> data

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>square</span>(x: int) <span style=color:#f92672>-</span><span style=color:#f92672>&gt;</span> int:
    time<span style=color:#f92672>.</span>sleep(<span style=color:#ae81ff>1e-3</span>)
    <span style=color:#66d9ef>return</span> x <span style=color:#f92672>*</span><span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span>

<span style=color:#75715e># For invoking multi processing we need __main__ module defined !! :)</span>
<span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74></span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>__main__</span><span style=color:#e6db74>&#34;</span>:
    input_iter <span style=color:#f92672>=</span> list(range(<span style=color:#ae81ff>100</span>))
    number <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>
    repeat <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>
    <span style=color:#66d9ef>print</span>(<span style=color:#e6db74></span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>1 prcess 1 thread</span><span style=color:#e6db74>&#34;</span>, timeit<span style=color:#f92672>.</span>repeat(<span style=color:#66d9ef>lambda</span>: [square(x) <span style=color:#66d9ef>for</span> x <span style=color:#f92672>in</span> input_iter], repeat<span style=color:#f92672>=</span>repeat, number<span style=color:#f92672>=</span>number))
    <span style=color:#66d9ef>print</span>(<span style=color:#e6db74></span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>1 prcess 5 thread</span><span style=color:#e6db74>&#34;</span>, timeit<span style=color:#f92672>.</span>repeat(<span style=color:#66d9ef>lambda</span>: parallelize(square, input_iter), repeat<span style=color:#f92672>=</span>repeat, number<span style=color:#f92672>=</span>number))
    <span style=color:#66d9ef>print</span>(<span style=color:#e6db74></span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>5 prcess 1 thread each</span><span style=color:#e6db74>&#34;</span>, timeit<span style=color:#f92672>.</span>repeat(<span style=color:#66d9ef>lambda</span>: parallelize(square, input_iter, use_thread<span style=color:#f92672>=</span>False), repeat<span style=color:#f92672>=</span>repeat, number<span style=color:#f92672>=</span>number))
</code></pre></div><p>Execution:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ python test_concurrency.py
<span style=color:#ae81ff>1</span> prcess <span style=color:#ae81ff>1</span> thread <span style=color:#f92672>[</span>1.2861979760000002, 1.298199268, 1.2918409180000001, 1.281806194, 1.295781883<span style=color:#f92672>]</span>
<span style=color:#ae81ff>1</span> prcess <span style=color:#ae81ff>5</span> thread <span style=color:#f92672>[</span>0.28324162100000017, 0.2827319930000005, 0.2845571439999999, 0.2883606469999993, 0.2812394300000003<span style=color:#f92672>]</span>
<span style=color:#ae81ff>5</span> prcess <span style=color:#ae81ff>1</span> thread each <span style=color:#f92672>[</span>1.5489112939999998, 1.5780382430000017, 1.5727520679999998, 1.5113713640000004, 1.524860704<span style=color:#f92672>]</span>
</code></pre></div><p><strong>Important Note:</strong></p><ul><li>We do have to know that with threading and multi-processing <em>it's strength is it's weakness</em>.</li><li>Hence restricting <code>max_workers</code> is key <em><code>pool_executor(max_workers=5)</code></em>.</li><li>If <code>max_workers=None</code> then it will spawn many threads and many processes which causes huge delay in thread/process management. So it will be slower compared to single process single thread.</li><li>You can play around <code>max_workers</code> count. <strong>But never set it to <code>None</code></strong></li></ul><p>Very usefull references:</p><ul><li>Python3.x moduel: <a href=https://docs.python.org/3/library/concurrent.futures.html#module-concurrent.futures>https://docs.python.org/3/library/concurrent.futures.html#module-concurrent.futures</a></li><li>Tiemit: <a href=https://docs.python.org/3/library/timeit.html#python-interface>https://docs.python.org/3/library/timeit.html#python-interface</a></li><li>RealPython site: <a href=https://realpython.com/intro-to-python-threading/#using-a-threadpoolexecutor>https://realpython.com/intro-to-python-threading/#using-a-threadpoolexecutor</a></li><li>Raymond Hettiger: <a href=https://pybay.com/site_media/slides/raymond2017-keynote/index.html>https://pybay.com/site_media/slides/raymond2017-keynote/index.html</a></li><li>David Beazley - A Curious Course on Coroutines and Concurrency: <a href=http://www.dabeaz.com/coroutines/>http://www.dabeaz.com/coroutines/</a></li></ul></main></div><footer id=footer class="mt-auto text-center text-muted"><div class=container>Made with <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/zwbetz-gh/vanilla-bootstrap-hugo-theme>Vanilla</a></div></footer><script src=https://puneethapai.github.io/js/feather.min.js></script><script>feather.replace()</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css integrity=sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js integrity=sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body);></script><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-171271234-1','auto');ga('send','pageview');</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>